<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Menu</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #fff8f0;
    margin: 0;
    padding: 0;
  }
  header {
    background-color: #d32f2f;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
  }
  .menu-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    padding: 20px;
  }
  .menu-item {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    overflow: hidden;
    text-align: center;
    transition: transform 0.2s;
  }
  .menu-item:hover {
    transform: scale(1.03);
  }
  .menu-item img {
    width: 70%;
    height: 150px;
    object-fit: cover;
  }
  .menu-details {
    padding: 10px;
  }
  .menu-details h3 {
    margin: 0;
    font-size: 18px;
    color: #b71c1c;
  }
  .menu-details p {
    margin: 5px 0;
    font-weight: bold;
    color: #444;
  }
  .add-btn {
    background: #ff7043;
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 8px;
  }
  .add-btn:hover {
    background: #f4511e;
  }

  /* Floating Cart Button */
  #cart-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #ff7043;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 28px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 30;
  }
  #cart-count-badge {
    position: absolute;
    top: 5px;
    right: 5px;
    background: #b71c1c;
    color: white;
    font-size: 14px;
    padding: 2px 6px;
    border-radius: 50%;
  }

  /* Overlay for closing cart */
  #cart-overlay {
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,0.5);
    display:none;
    z-index: 25;
  }

  /* Cart Sidebar */
  #cart-sidebar {
    position: fixed;
    top: 0;
    right: -350px;
    width: 300px;
    height: 100%;
    background: white;
    box-shadow: -2px 0 8px rgba(0,0,0,0.2);
    padding: 20px;
    transition: right 0.3s ease;
    z-index: 26;
    overflow-y: auto;
  }
  #cart-sidebar.open {
    right: 0;
  }
  #cart-sidebar h2 {
    margin-top: 0;
    color: #d32f2f;
  }
  .qty-btn {
    background: #ff7043;
    border: none;
    color: white;
    padding: 2px 8px;
    margin: 0 4px;
    border-radius: 4px;
    cursor: pointer;
  }
  .qty-btn:hover {
    background: #f4511e;
  }
  .qty-display {
    min-width: 20px;
    display: inline-block;
    text-align: center;
  }
  .remove-btn {
    background: #ccc;
    border: none;
    padding: 2px 6px;
    border-radius: 4px;
    cursor: pointer;
    margin-left: 5px;
  }
  .remove-btn:hover {
    background: #aaa;
  }
  #checkout-btn {
    background: #d32f2f;
    color: white;
    border: none;
    padding: 8px;
    border-radius: 6px;
    cursor: pointer;
    width: 100%;
    margin-top: 10px;
  }
  #checkout-btn:hover {
    background: #b71c1c;
  }
</style>
</head>
<body>

<header>Menu</header>

<div class="menu-container" id="menu-container">
  <!-- Menu items from JSON will load here -->
</div>

<!-- Floating Cart Button -->
<div id="cart-button" onclick="toggleCart()">
  ðŸ›’
  <div id="cart-count-badge">0</div>
</div>

<!-- Cart Overlay -->
<div id="cart-overlay" onclick="toggleCart()"></div>

<!-- Cart Sidebar -->
<div id="cart-sidebar">
  <h2>Your Cart <button onclick="toggleCart()" style="float:right;">âœ–</button></h2>
  <ul id="cart-items"></ul>
  <p>Total: RM<span id="total-price">0.00</span></p>
  <input type="email" id="email" placeholder="Your email" style="width:100%;padding:5px;margin-bottom:8px;">
  <button id="checkout-btn" onclick="checkout()">Submit Order</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
  emailjs.init("R6l7h-YglseJibwK1"); // replace with your EmailJS public key

  let cart = {};

  // Load menu.json
  fetch("menu.json")
    .then(res => res.json())
    .then(data => {
      const menuContainer = document.getElementById("menu-container");
      data.forEach(item => {
        const div = document.createElement("div");
        div.classList.add("menu-item");
        div.innerHTML = `
          <img src="${item.image}" alt="${item.name}">
          <div class="menu-details">
            <h3>${item.name}</h3>
            <p>RM${item.price.toFixed(2)}</p>
            <button class="add-btn" onclick="addToCart('${item.name}', ${item.price})">Add to Cart</button>
          </div>
        `;
        menuContainer.appendChild(div);
      });
    });

  function toggleCart() {
    const sidebar = document.getElementById("cart-sidebar");
    const overlay = document.getElementById("cart-overlay");
    if (sidebar.classList.contains("open")) {
      sidebar.classList.remove("open");
      overlay.style.display = "none";
    } else {
      sidebar.classList.add("open");
      overlay.style.display = "block";
    }
  }

  function addToCart(itemName, itemPrice) {
    if (cart[itemName]) {
      cart[itemName].quantity++;
    } else {
      cart[itemName] = { price: itemPrice, quantity: 1 };
    }
    updateCart();
  }

  function removeFromCart(itemName) {
    delete cart[itemName];
    updateCart();
  }

  function changeQuantity(itemName, delta) {
    if (!cart[itemName]) return;
    cart[itemName].quantity += delta;
    if (cart[itemName].quantity <= 0) {
      delete cart[itemName];
    }
    updateCart();
  }

  function updateCart() {
    const cartItemsContainer = document.getElementById("cart-items");
    cartItemsContainer.innerHTML = "";

    let totalItems = 0;
    let totalPrice = 0;

    for (let itemName in cart) {
      let item = cart[itemName];
      totalItems += item.quantity;
      totalPrice += item.price * item.quantity;

      const li = document.createElement("li");
      li.innerHTML = `
        ${itemName} - RM${item.price.toFixed(2)} Ã— 
        <button class="qty-btn" onclick="changeQuantity('${itemName}', -1)">âˆ’</button>
        <span class="qty-display">${item.quantity}</span>
        <button class="qty-btn" onclick="changeQuantity('${itemName}', 1)">+</button>
        = RM${(item.price * item.quantity).toFixed(2)}
        <button class="remove-btn" onclick="removeFromCart('${itemName}')">Remove</button>
      `;
      cartItemsContainer.appendChild(li);
    }

    document.getElementById("total-price").textContent = totalPrice.toFixed(2);
    document.getElementById("cart-count-badge").textContent = totalItems;
  }

  function checkout() {
    const email = document.getElementById("email").value;
    if (!email) {
      alert("Please enter your email");
      return;
    }
    const orderDetails = Object.keys(cart).map(itemName => {
      const item = cart[itemName];
      return `${itemName} - ${item.quantity} x RM${item.price.toFixed(2)}`;
    }).join("\n");

    emailjs.send("service_z3uur5v", "template_6jh445v", // replace with your service and template ID
    {
      customer_email: email,
      cart_items: orderDetails,
      total_price: document.getElementById("total-price").textContent
    })
    .then(() => {
      alert("Order sent successfully!");
      cart = {};
      updateCart();
      toggleCart();
    })
    .catch(() => {
      alert("Failed to send order. Please try again.");
    });
  }
</script>

</body>
</html>
